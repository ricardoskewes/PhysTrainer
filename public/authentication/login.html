<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar sesion</title>
</head>
<body>
    <h1>Iniciar sesion</h1>
    <form id="login">
        <label for="email">Correo electronico: </label>
        <input type="email" name="email" id="email"> <br>
        <label for="password">Contrasena</label>
        <input type="password" name="password" id="password">
        <hr>
        <input type="submit" value="Iniciar sesion">
    </form>
    <script type="module">
        import firebase from '/firebase-client.js';
        document
            .querySelector('form')
            .addEventListener('submit', async (e)=>{
                e.preventDefault();
                const {email, password} = e.target;
                // Sign in using firebase
                try{
                    const {user} = await firebase.auth().signInWithEmailAndPassword(email.value, password.value);
                    // Get user token
                    const userToken = await user.getIdToken();
                    // Authenticate in server
                    const request = await fetch('/api/v1/authentication/login', {
                        method: 'POST', 
                        headers: {
                            Accept: 'application/json', 
                            'Content-Type': 'application/json'
                        }, 
                        body: JSON.stringify({userToken})
                    })
                    // Get response
                    const response = await request.json();
                    alert(JSON.stringify(response));
                } catch(e){
                    alert(JSON.stringify(e))
                }
            })
    </script>

</body>
</html>l