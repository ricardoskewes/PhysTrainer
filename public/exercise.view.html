<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Create, solve and share exercises online using PhysTrainer.">
	<meta property="og:title" content="{{exercise.title}}">
	<meta property="og:description" content="{{exercise.title}}">
	<title>{{exercise.title}} - PhysTrainer Exercise</title>
	<style>
		header h1, 
		pt-exercise {
			max-width: 800px;
			width: 100%;
			margin-left: auto;
			margin-right: auto;
		}

		header h1{
			font-size: 3rem;
			font-family: serif;
			text-align: center;
		}
	</style>
</head>

<body>
	<header>
		<h1>{{exercise.title}}</h1>
	</header>
	<div style="text-align: center; margin: 16px">
		<button id="exercise-update">Update</button>
		<button id="exercise-add-question">Add question</button>
		<button id="exercise-add-markdown">Add markdown</button>
		<button id="exercise-submit-answers">Submit</button>
	</div>
	<pt-exercise contenteditable="true">
		{{{exercise.json}}}
	</pt-exercise>
	<script src="/components/PTExercise/PTExercise.js" type="module"></script>
	<script src="/components/PTExerciseCell/PTExerciseCellMarkdown.js" type="module"></script>
	<script src="/components/PTExerciseCell/PTExerciseCellQuestion.js" type="module"></script>

	<script type="module">
		const exercise = document.querySelector('pt-exercise');
		import firebase, {phystrainerAPI} from '/phystrainerAPI.js';
		
		firebase.auth().onAuthStateChanged((user)=>{
            if(exercise.getData().author.authorID != user.uid) exercise.setAttribute('locked', true)
        })

		async function upload(){
			const req = await phystrainerAPI(`/api/1/exercises/update?exerciseID=${exercise.getData().exerciseID}`, {
				method: 'POST', 
				body: JSON.stringify(document.querySelector('pt-exercise').getData()),
				headers: {
					'Content-Type': 'application/json'
				}
			})
			const res = await req.json();
			alert(res);
		}

		document.querySelector('#exercise-update').addEventListener('click', upload)
		document.querySelector('#exercise-add-question').addEventListener('click', ()=>{
			exercise.addItem('question', {
                type: 'PTQuestion.text',
                description: 'Double click to edit question'
            })
		})

		document.querySelector('#exercise-add-markdown').addEventListener('click', ()=>{
			exercise.addItem('markdown', 'Double click to edit cell')
		})
		
		document.querySelector('#exercise-submit-answers').addEventListener('click', ()=>{
			exercise.submit();
		})
	</script>
</body>

</html>